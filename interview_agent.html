<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Interview Coach</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f64f59 100%);
            color: white;
            padding: 50px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 3em;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            letter-spacing: -1px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            font-weight: 400;
            position: relative;
        }

        .content {
            padding: 50px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Category Selection */
        .welcome-title {
            text-align: center;
            color: #1a202c;
            margin-bottom: 15px;
            font-size: 2.2em;
            font-weight: 700;
        }

        .welcome-subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.1em;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .category-card {
            background: linear-gradient(145deg, #ffffff 0%, #f7fafc 100%);
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 35px 28px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .category-card:hover {
            transform: translateY(-10px);
            border-color: #667eea;
            box-shadow: 0 25px 50px rgba(102, 126, 234, 0.2);
        }

        .category-card:hover::before {
            transform: scaleX(1);
        }

        .category-icon {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .category-card h3 {
            color: #1a202c;
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .category-card p {
            color: #718096;
            margin-bottom: 18px;
            font-size: 0.95em;
        }

        .category-meta {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .meta-badge {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            color: #667eea;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        /* Interview Screen */
        .progress-container {
            margin-bottom: 30px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-text {
            color: #4a5568;
            font-weight: 600;
            font-size: 1em;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 5px;
            position: relative;
        }

        .progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .interview-display {
            background: linear-gradient(145deg, #f8fafc 0%, #edf2f7 100%);
            border-radius: 20px;
            padding: 45px;
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .question-number {
            position: absolute;
            top: 20px;
            left: 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .question-text {
            font-size: 1.5em;
            color: #1a202c;
            text-align: center;
            line-height: 1.7;
            font-weight: 500;
            margin-top: 20px;
        }

        .tips-panel {
            background: linear-gradient(135deg, #ebf8ff 0%, #e6fffa 100%);
            border-radius: 16px;
            padding: 20px 25px;
            margin-bottom: 25px;
            border-left: 4px solid #4299e1;
        }

        .tips-panel h4 {
            color: #2b6cb0;
            margin-bottom: 12px;
            font-size: 1em;
        }

        .tips-panel ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .tips-panel li {
            color: #4a5568;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .response-section {
            margin-bottom: 25px;
        }

        .response-label {
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 12px;
            display: block;
            font-size: 1.1em;
        }

        .response-input {
            width: 100%;
            min-height: 160px;
            padding: 22px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 1.05em;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
            line-height: 1.6;
            background: #fafbfc;
        }

        .response-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            background: white;
        }

        .response-input::placeholder {
            color: #a0aec0;
        }

        .word-count {
            text-align: right;
            color: #718096;
            font-size: 0.9em;
            margin-top: 8px;
        }

        .controls {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 36px;
            border: none;
            border-radius: 14px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #fc8181, #f56565);
            color: white;
        }

        .btn-secondary {
            background: #edf2f7;
            color: #4a5568;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Analysis Panel */
        .analysis-panel {
            background: linear-gradient(145deg, #f0fff4 0%, #ebf8ff 100%);
            border-radius: 16px;
            padding: 28px;
            margin-top: 25px;
            border: 1px solid #c6f6d5;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .analysis-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #276749;
        }

        .analysis-score {
            font-size: 2em;
            font-weight: 800;
            padding: 10px 25px;
            border-radius: 12px;
        }

        .score-excellent { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
        .score-good { background: linear-gradient(135deg, #ecc94b, #d69e2e); color: white; }
        .score-average { background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; }
        .score-poor { background: linear-gradient(135deg, #fc8181, #f56565); color: white; }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .score-item {
            background: white;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .score-item-value {
            font-size: 1.6em;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .score-item-label {
            color: #718096;
            font-size: 0.85em;
            font-weight: 500;
        }

        .feedback-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .feedback-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
        }

        .feedback-box h5 {
            margin-bottom: 12px;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feedback-box.strengths h5 { color: #276749; }
        .feedback-box.improvements h5 { color: #c05621; }

        .feedback-box ul {
            list-style: none;
        }

        .feedback-box li {
            padding: 8px 0;
            color: #4a5568;
            font-size: 0.95em;
            border-bottom: 1px solid #f0f0f0;
        }

        .feedback-box li:last-child {
            border-bottom: none;
        }

        /* Loading Screen */
        .loading-container {
            text-align: center;
            padding: 80px 40px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #4a5568;
            font-size: 1.2em;
            font-weight: 500;
        }

        .loading-subtext {
            color: #a0aec0;
            font-size: 0.95em;
            margin-top: 10px;
        }

        /* Results Screen */
        .results-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .results-title {
            font-size: 2.5em;
            font-weight: 800;
            color: #1a202c;
            margin-bottom: 10px;
        }

        .results-subtitle {
            color: #718096;
            font-size: 1.1em;
        }

        .final-score-container {
            text-align: center;
            margin: 40px 0;
        }

        .final-score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            position: relative;
            box-shadow: 0 20px 50px rgba(102, 126, 234, 0.4);
        }

        .final-score-circle::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            z-index: -1;
            opacity: 0.5;
            filter: blur(15px);
        }

        .final-score-value {
            font-size: 3.5em;
            font-weight: 800;
        }

        .final-score-max {
            font-size: 1em;
            opacity: 0.8;
        }

        .final-score-label {
            font-size: 1.3em;
            color: #4a5568;
            font-weight: 600;
        }

        .results-feedback {
            background: #f8fafc;
            border-radius: 20px;
            padding: 35px;
            margin: 30px 0;
        }

        .results-feedback h3 {
            color: #1a202c;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .results-feedback p {
            color: #4a5568;
            font-size: 1.1em;
            line-height: 1.7;
        }

        .results-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 35px 0;
        }

        .breakdown-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        .breakdown-value {
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .breakdown-label {
            color: #718096;
            font-size: 0.95em;
            font-weight: 500;
            text-transform: capitalize;
        }

        .results-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 30px;
        }

        .detail-section {
            background: white;
            padding: 28px;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
        }

        .detail-section h4 {
            font-size: 1.15em;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-section.strengths h4 { color: #276749; }
        .detail-section.improvements h4 { color: #c05621; }

        .detail-item {
            padding: 14px 18px;
            margin: 10px 0;
            border-radius: 10px;
            font-size: 0.95em;
        }

        .detail-section.strengths .detail-item {
            background: linear-gradient(135deg, #f0fff4, #e6fffa);
            color: #276749;
            border-left: 4px solid #48bb78;
        }

        .detail-section.improvements .detail-item {
            background: linear-gradient(135deg, #fffaf0, #fefcbf);
            color: #c05621;
            border-left: 4px solid #ed8936;
        }

        .results-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* Voice Transcription Section */
        .transcription-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .transcription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .transcription-title {
            color: #4a5568;
            font-weight: 600;
            font-size: 1em;
        }

        .transcription-text {
            color: #2d3748;
            font-size: 0.95em;
            line-height: 1.6;
            min-height: 40px;
        }

        /* Feature Cards */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 35px 0;
        }

        .feature-card {
            background: white;
            padding: 28px 22px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
        }

        .feature-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .feature-card h4 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .feature-card p {
            color: #718096;
            font-size: 0.9em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .content {
                padding: 25px;
            }

            .header h1 {
                font-size: 2em;
            }

            .category-grid {
                grid-template-columns: 1fr;
            }

            .results-details {
                grid-template-columns: 1fr;
            }

            .feedback-section {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                justify-content: center;
            }

            .score-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Color utilities */
        .color-excellent { color: #48bb78; }
        .color-good { color: #ecc94b; }
        .color-average { color: #ed8936; }
        .color-poor { color: #f56565; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ AI Interview Coach</h1>
            <p>Master your interview skills with intelligent AI feedback</p>
        </div>

        <div class="content">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="screen active">
                <h2 class="welcome-title">Welcome to Your AI Interview Coach</h2>
                <p class="welcome-subtitle">
                    Practice with our intelligent interview system. Get real-time feedback, 
                    scoring, and personalized improvement suggestions.
                </p>

                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üé§</div>
                        <h4>Voice Recording</h4>
                        <p>Speak naturally and get transcribed</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ü§ñ</div>
                        <h4>AI Analysis</h4>
                        <p>Advanced NLP scoring engine</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìä</div>
                        <h4>Detailed Scoring</h4>
                        <p>Comprehensive performance metrics</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üí°</div>
                        <h4>Smart Feedback</h4>
                        <p>Actionable improvement tips</p>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-primary" onclick="showCategoryScreen()" style="padding: 18px 50px; font-size: 1.1em;">
                        üöÄ Start Interview Practice
                    </button>
                </div>
            </div>

            <!-- Category Selection Screen -->
            <div id="categoryScreen" class="screen">
                <h2 class="welcome-title">Choose Your Interview Type</h2>
                <p class="welcome-subtitle">Select a category to begin your 8-question practice session</p>

                <div class="category-grid" id="categoriesGrid">
                    <!-- Categories will be loaded dynamically -->
                </div>

                <div style="text-align: center; margin-top: 35px;">
                    <button class="btn btn-secondary" onclick="showWelcomeScreen()">
                        ‚Üê Back to Home
                    </button>
                </div>
            </div>

            <!-- Interview Screen -->
            <div id="interviewScreen" class="screen">
                <div class="progress-container">
                    <div class="progress-header">
                        <span class="progress-text" id="progressText">Question 1 of 8</span>
                        <span class="progress-text" id="categoryBadge">Technical</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progress" class="progress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="interview-display">
                    <div class="question-number" id="questionNumber">Q1</div>
                    <div id="questionText" class="question-text">
                        Loading question...
                    </div>
                </div>

                <div class="tips-panel">
                    <h4>üí° Tips for Better Scores</h4>
                    <ul>
                        <li>‚úì Be specific with examples</li>
                        <li>‚úì Use relevant terminology</li>
                        <li>‚úì Aim for 30-100 words</li>
                        <li>‚úì Structure your answer clearly</li>
                    </ul>
                </div>

                <div class="response-section">
                    <label class="response-label">Your Response:</label>
                    <textarea 
                        id="responseInput" 
                        class="response-input" 
                        placeholder="Type your answer here or use voice recording..."
                        oninput="updateWordCount()"
                    ></textarea>
                    <div class="word-count" id="wordCount">0 words</div>
                </div>

                <div class="controls">
                    <button id="startRecordBtn" class="btn btn-primary" onclick="startRecording()">
                        üé§ Start Recording
                    </button>
                    <button id="stopRecordBtn" class="btn btn-danger" onclick="stopRecording()" disabled>
                        ‚èπÔ∏è Stop Recording
                    </button>
                    <button id="submitBtn" class="btn btn-success" onclick="submitResponse()">
                        ‚úì Submit Answer
                    </button>
                </div>

                <div class="transcription-section">
                    <div class="transcription-header">
                        <span class="transcription-title">üéôÔ∏è Voice Transcription</span>
                    </div>
                    <p id="responseText" class="transcription-text">
                        Your voice transcription will appear here...
                    </p>
                </div>

                <div id="analysisSection" class="analysis-panel" style="display: none;">
                    <!-- Analysis will be inserted here -->
                </div>

                <div style="text-align: center; margin-top: 25px;">
                    <button class="btn btn-secondary" onclick="restartInterview()">
                        üîÑ Restart Interview
                    </button>
                </div>
            </div>

            <!-- Loading Screen -->
            <div id="loadingScreen" class="screen">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <p class="loading-text" id="loadingText">Analyzing your response...</p>
                    <p class="loading-subtext">Our AI is evaluating your answer</p>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="screen">
                <div class="results-header">
                    <h2 class="results-title">üéâ Interview Complete!</h2>
                    <p class="results-subtitle">Here's your performance summary</p>
                </div>

                <div class="final-score-container">
                    <div class="final-score-circle">
                        <div>
                            <span class="final-score-value" id="finalScoreValue">0</span>
                            <span class="final-score-max">/10</span>
                        </div>
                    </div>
                    <p class="final-score-label">Overall Score</p>
                </div>

                <div class="results-feedback">
                    <h3>üìã AI Feedback</h3>
                    <p id="feedbackText">Loading feedback...</p>
                </div>

                <div class="results-breakdown" id="breakdownContainer">
                    <!-- Breakdown cards will be inserted here -->
                </div>

                <div class="results-details">
                    <div class="detail-section strengths">
                        <h4>‚úÖ Your Strengths</h4>
                        <div id="strengthsList">
                            <!-- Strengths will be inserted here -->
                        </div>
                    </div>
                    <div class="detail-section improvements">
                        <h4>üí° Areas to Improve</h4>
                        <div id="improvementsList">
                            <!-- Improvements will be inserted here -->
                        </div>
                    </div>
                </div>

                <div class="results-actions">
                    <button class="btn btn-primary" onclick="restartInterview()">
                        üîÑ Practice Again
                    </button>
                    <button class="btn btn-secondary" onclick="showWelcomeScreen()">
                        üè† Back to Home
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        let currentInterview = {
            id: null,
            category: null,
            currentQuestion: 0,
            totalQuestions: 8,
            questions: []
        };
        

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();
            initializeSpeechRecognition();
            console.log('AI Interview Coach initialized');
        });

        // Screen navigation
        function showWelcomeScreen() {
            hideAllScreens();
            document.getElementById('welcomeScreen').classList.add('active');
        }

        function showCategoryScreen() {
            hideAllScreens();
            document.getElementById('categoryScreen').classList.add('active');
        }

        function showInterviewScreen() {
            hideAllScreens();
            document.getElementById('interviewScreen').classList.add('active');
        }

        function showLoadingScreen(message = 'Processing...') {
            hideAllScreens();
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingScreen').classList.add('active');
        }

        function showResultsScreen() {
            hideAllScreens();
            document.getElementById('resultsScreen').classList.add('active');
        }

        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
        }

        // Load categories from backend
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`);
                if (!response.ok) throw new Error('Failed to load categories');
                
                const categories = await response.json();
                renderCategories(categories);
            } catch (error) {
                console.error('Error loading categories:', error);
                // Fallback categories
                const fallbackCategories = [
                    { id: 'technical', name: 'Technical Interview', description: 'Programming, algorithms, system design questions', duration: '15-20 min', difficulty: 'Intermediate' },
                    { id: 'behavioral', name: 'Behavioral Interview', description: 'Teamwork, leadership, problem-solving scenarios', duration: '10-15 min', difficulty: 'All Levels' },
                    { id: 'management', name: 'Management Interview', description: 'Leadership, strategy, decision-making questions', duration: '20-25 min', difficulty: 'Advanced' },
                    { id: 'sales', name: 'Sales & Marketing', description: 'Customer relations, strategy, pitching scenarios', duration: '15-20 min', difficulty: 'Intermediate' }
                ];
                renderCategories(fallbackCategories);
            }
        }

        function renderCategories(categories) {
            const icons = { technical: 'üíª', behavioral: 'ü§ù', management: 'üëî', sales: 'üìà' };
            const grid = document.getElementById('categoriesGrid');
            
            grid.innerHTML = categories.map(cat => `
                <div class="category-card" onclick="selectCategory('${cat.id}')">
                    <div class="category-icon">${icons[cat.id] || 'üìã'}</div>
                    <h3>${cat.name}</h3>
                    <p>${cat.description}</p>
                    <div class="category-meta">
                        <span class="meta-badge">${cat.duration}</span>
                        <span class="meta-badge">${cat.difficulty}</span>
                        <span class="meta-badge">8 Questions</span>
                    </div>
                </div>
            `).join('');
        }

        // Select category and start interview
        async function selectCategory(categoryId) {
            try {
                showLoadingScreen('Preparing your 8 interview questions...');
                
                // Reset transcript before starting
                resetTranscript();

                const response = await fetch(`${API_BASE}/start-interview?category=${categoryId}`, {
                    method: 'POST'
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to start interview');
                }
                
                const data = await response.json();
                console.log('Interview started:', data);
                
                // Initialize current interview
                currentInterview = {
                    id: data.interview_id,
                    category: data.category,
                    currentQuestion: data.question_index,
                    totalQuestions: data.total_questions
                };
                
                // Update UI
                document.getElementById('questionText').textContent = data.question;
                document.getElementById('responseInput').value = '';
                document.getElementById('responseText').textContent = 'Your voice transcription will appear here...';
                document.getElementById('analysisSection').style.display = 'none';
                document.getElementById('categoryBadge').textContent = capitalizeFirst(data.category);
                
                updateProgressDisplay();
                showInterviewScreen();
                speakText(data.question);
                
            } catch (error) {
                console.error('Error starting interview:', error);
                alert('Error starting interview: ' + error.message);
                showCategoryScreen();
            }
        }

        // Update progress display
        function updateProgressDisplay() {
            const current = currentInterview.currentQuestion + 1;
            const total = currentInterview.totalQuestions;
            const progress = (currentInterview.currentQuestion / total) * 100;
            
            document.getElementById('progressText').textContent = `Question ${current} of ${total}`;
            document.getElementById('questionNumber').textContent = `Q${current}`;
            document.getElementById('progress').style.width = progress + '%';
        }

        // Word count
        function updateWordCount() {
            const text = document.getElementById('responseInput').value.trim();
            const words = text ? text.split(/\s+/).length : 0;
            document.getElementById('wordCount').textContent = `${words} words`;
        }

        // Initialize speech recognition
        // Speech Recognition Variables
        let recognition = null;
        let isRecording = false;
        let finalTranscript = ''; // This needs to be reset

        // Initialize speech recognition
        function initializeSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                console.warn('Speech recognition not supported');
                return;
            }

            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                console.log('Speech recognition started');
                isRecording = true;
                // IMPORTANT: Reset transcript when starting new recording
                finalTranscript = '';
                document.getElementById('startRecordBtn').disabled = true;
                document.getElementById('stopRecordBtn').disabled = false;
                document.getElementById('responseText').textContent = 'Listening...';
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                
                // Only process new results
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + ' ';
                    } else {
                        interimTranscript += transcript;
                    }
                }

                // Update display
                const displayText = (finalTranscript + interimTranscript).trim();
                document.getElementById('responseText').textContent = displayText || 'Listening...';
                document.getElementById('responseInput').value = displayText;
                updateWordCount();
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                stopRecording();
            };

            recognition.onend = () => {
                console.log('Speech recognition ended');
                // Only restart if still recording
                if (isRecording) {
                    try {
                        recognition.start();
                    } catch (e) {
                        console.log('Could not restart recognition');
                    }
                }
            };
        }

        // Start recording - RESET transcript here
        function startRecording() {
            if (!recognition) {
                initializeSpeechRecognition();
            }
            
            if (!recognition) {
                alert('Speech recognition not supported in this browser. Please use Chrome or Edge.');
                return;
            }

            try {
                // IMPORTANT: Reset the transcript before starting
                finalTranscript = '';
                document.getElementById('responseInput').value = '';
                document.getElementById('responseText').textContent = 'Listening...';
                
                recognition.start();
            } catch (error) {
                console.error('Error starting recognition:', error);
                // If already started, stop and restart
                recognition.stop();
                setTimeout(() => {
                    finalTranscript = '';
                    recognition.start();
                }, 100);
            }
        }

        // Stop recording
        function stopRecording() {
            isRecording = false;
            
            if (recognition) {
                recognition.stop();
            }
            
            document.getElementById('startRecordBtn').disabled = false;
            document.getElementById('stopRecordBtn').disabled = true;
            
            // Update final text
            const finalText = document.getElementById('responseInput').value.trim();
            if (finalText) {
                document.getElementById('responseText').textContent = finalText;
            } else {
                document.getElementById('responseText').textContent = 'No speech detected. Please type your answer.';
            }
        }

        // IMPORTANT: Reset transcript when moving to next question
        function resetTranscript() {
            finalTranscript = '';
            document.getElementById('responseInput').value = '';
            document.getElementById('responseText').textContent = 'Your voice transcription will appear here...';
            document.getElementById('wordCount').textContent = '0 words';
        }

        // Submit response
        async function submitResponse() {
            const responseText = document.getElementById('responseInput').value.trim();
            
            if (!responseText) {
                alert('Please provide an answer before submitting.');
                return;
            }
            
            if (responseText.length < 10) {
                alert('Please provide a more detailed response.');
                return;
            }
            
            // Stop recording if active
            if (isRecording) {
                stopRecording();
            }
            
            try {
                showLoadingScreen('Analyzing your response with AI...');
                
                const formData = new URLSearchParams();
                formData.append('interview_id', currentInterview.id);
                formData.append('response_text', responseText);
                
                const response = await fetch(`${API_BASE}/submit-response`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to submit response');
                }
                
                const data = await response.json();
                
                if (data.interview_complete) {
                    showResults(data);
                } else {
                    // Update state
                    currentInterview.currentQuestion = data.question_index;
                    currentInterview.totalQuestions = data.total_questions;
                    
                    // Update UI with next question
                    document.getElementById('questionText').textContent = data.next_question;
                    
                    // IMPORTANT: Reset transcript for next question
                    resetTranscript();
                    
                    updateProgressDisplay();
                    
                    if (data.current_response_analysis) {
                        showResponseAnalysis(data.current_response_analysis);
                    }
                    
                    showInterviewScreen();
                    speakText(data.next_question);
                }
                
            } catch (error) {
                console.error('Error submitting response:', error);
                alert('Error: ' + error.message);
                showInterviewScreen();
            }
        }

        // Show response analysis
        function showResponseAnalysis(analysis) {
            const scoreClass = getScoreClass(analysis.overall_score);
            const scoreColor = getScoreColor(analysis.overall_score);
            
            const analysisHTML = `
                <div class="analysis-header">
                    <span class="analysis-title">üìä Response Analysis</span>
                    <span class="analysis-score ${scoreClass}">${analysis.overall_score}/10</span>
                </div>
                
                <div class="score-breakdown">
                    <div class="score-item">
                        <div class="score-item-value" style="color: ${getScoreColor(analysis.relevance_score)}">${analysis.relevance_score}</div>
                        <div class="score-item-label">Relevance</div>
                    </div>
                    <div class="score-item">
                        <div class="score-item-value" style="color: ${getScoreColor(analysis.completeness_score)}">${analysis.completeness_score}</div>
                        <div class="score-item-label">Completeness</div>
                    </div>
                    <div class="score-item">
                        <div class="score-item-value" style="color: ${getScoreColor(analysis.clarity_score)}">${analysis.clarity_score}</div>
                        <div class="score-item-label">Clarity</div>
                    </div>
                    <div class="score-item">
                        <div class="score-item-value" style="color: ${getScoreColor(analysis.technical_accuracy)}">${analysis.technical_accuracy}</div>
                        <div class="score-item-label">Accuracy</div>
                    </div>
                </div>
                
                <div class="feedback-section">
                    <div class="feedback-box strengths">
                        <h5>‚úÖ Strengths</h5>
                        <ul>
                            ${analysis.strengths.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="feedback-box improvements">
                        <h5>üí° Improvements</h5>
                        <ul>
                            ${analysis.improvement_areas.map(i => `<li>${i}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('analysisSection').innerHTML = analysisHTML;
            document.getElementById('analysisSection').style.display = 'block';
        }

        // Show final results
        function showResults(data) {
            document.getElementById('finalScoreValue').textContent = data.final_score;
            document.getElementById('feedbackText').textContent = data.detailed_feedback;
            
            // Render breakdown
            const breakdownContainer = document.getElementById('breakdownContainer');
            if (data.category_breakdown) {
                breakdownContainer.innerHTML = Object.entries(data.category_breakdown).map(([category, score]) => `
                    <div class="breakdown-card">
                        <div class="breakdown-value" style="color: ${getScoreColor(score)}">${score}</div>
                        <div class="breakdown-label">${category.replace('_', ' ')}</div>
                    </div>
                `).join('');
            }
            
            // Render strengths
            const strengthsList = document.getElementById('strengthsList');
            if (data.strength_analysis && data.strength_analysis.length > 0) {
                strengthsList.innerHTML = data.strength_analysis.map(s => 
                    `<div class="detail-item">${s}</div>`
                ).join('');
            } else {
                strengthsList.innerHTML = '<div class="detail-item">Complete more questions for detailed analysis</div>';
            }
            
            // Render improvements
            const improvementsList = document.getElementById('improvementsList');
            if (data.areas_for_improvement && data.areas_for_improvement.length > 0) {
                improvementsList.innerHTML = data.areas_for_improvement.map(i => 
                    `<div class="detail-item">${i}</div>`
                ).join('');
            } else {
                improvementsList.innerHTML = '<div class="detail-item">Keep practicing for more suggestions</div>';
            }
            
            showResultsScreen();
            speakText(`Interview completed. Your score is ${data.final_score} out of 10. ${data.detailed_feedback}`);
        }

        // Utility functions
        function getScoreClass(score) {
            if (score >= 8) return 'score-excellent';
            if (score >= 6) return 'score-good';
            if (score >= 4) return 'score-average';
            return 'score-poor';
        }

        function getScoreColor(score) {
            if (score >= 8) return '#48bb78';
            if (score >= 6) return '#ecc94b';
            if (score >= 4) return '#ed8936';
            return '#f56565';
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Text-to-speech
        function speakText(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }

        // Restart interview
        function restartInterview() {
            currentInterview = {
                id: null,
                category: null,
                currentQuestion: 0,
                totalQuestions: 8,
                questions: []
            };
            
            document.getElementById('progress').style.width = '0%';
            document.getElementById('responseInput').value = '';
            document.getElementById('wordCount').textContent = '0 words';
            document.getElementById('analysisSection').style.display = 'none';
            
            showCategoryScreen();
        }

        // Handle visibility change
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                window.speechSynthesis.cancel();
                if (isRecording) stopRecording();
            }
        });
    </script>
</body>
</html>